<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thirunelveli AURA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-4xl sm:text-5xl font-bold text-gray-900">Thirunelveli AURA  - Student Projects - 11th October, 2025</h1>
            <p class="mt-2 text-lg text-gray-600">A Showcase of Student Web Apps from Vibe Coding</p>
        </header>

        <div class="text-center mb-6">
            <button id="refresh-button" class="bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-md hover:bg-gray-300 transition-colors text-sm">
                Clear Cache & Refresh Projects
            </button>
        </div>

        <main id="project-gallery" class="card-container">
            <!-- Loading message -->
            <div id="loading" class="col-span-full text-center text-gray-500">
                <p>Loading projects...</p>
            </div>
            <!-- Projects will be dynamically inserted here -->
        </main>

        <footer class="text-center mt-12 text-gray-500">
            <p>Curated by S. Rathinagiri &copy; 2025</p>
        </footer>
    </div>

    <script>
        // --- GitHub Repository Configuration ---
        const GITHUB_OWNER = 'SRathinaGiri';
        const GITHUB_REPO = 'ThirunelveliAURA';
        const CACHE_KEY = 'auraProjectsCache';
        const CACHE_VERSION = 'v2'; // Increment to invalidate old cache

        // --- Function to Render Projects to the DOM ---
        function renderProjects(projects) {
            const gallery = document.getElementById('project-gallery');
            gallery.innerHTML = ''; // Clear existing content

            if (!projects || projects.length === 0) {
                 gallery.innerHTML = '<p class="col-span-full text-center text-gray-500">No projects found.</p>';
                 return;
            }
            
            // Sort projects alphabetically by name
            projects.sort((a, b) => a.name.localeCompare(b.name));

            projects.forEach(project => {
                const card = document.createElement('div');
                card.className = 'bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-lg transition-shadow duration-300 flex flex-col';
                card.innerHTML = `
                    <div class="p-5 flex-grow">
                        <h2 class="text-xl font-semibold text-gray-800 capitalize">${project.name}</h2>
                    </div>
                    <div class="p-5 bg-gray-50 border-t border-gray-200 grid grid-cols-2 gap-3 text-sm">
                         <a href="${project.liveUrl}" target="_blank" rel="noopener noreferrer" class="text-center font-medium bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition-colors">
                            View App
                        </a>
                        <a href="${project.promptUrl}" target="_blank" rel="noopener noreferrer" class="text-center font-medium bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition-colors">
                            View Prompt
                        </a>
                    </div>
                `;
                gallery.appendChild(card);
            });
        }

        // --- Main Function to Fetch and Display Projects ---
        async function loadProjects() {
            const loadingIndicator = document.getElementById('loading');
            
            // Try to load from cache first
            try {
                const cachedData = JSON.parse(sessionStorage.getItem(CACHE_KEY));
                if (cachedData && cachedData.version === CACHE_VERSION && cachedData.projects) {
                    console.log("Loading projects from cache.");
                    renderProjects(cachedData.projects);
                    loadingIndicator.style.display = 'none';
                    return;
                }
            } catch (e) {
                console.warn("Could not parse cache. Fetching fresh data.");
                sessionStorage.removeItem(CACHE_KEY);
            }


            console.log("Fetching projects from GitHub API...");
            // Use the more efficient `trees` API to get all files in one request
            const GITHUB_API_URL = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/git/trees/main?recursive=1`;
            const LIVE_PAGE_BASE_URL = `https://${GITHUB_OWNER}.github.io/${GITHUB_REPO}/`;
            const GITHUB_BLOB_BASE_URL = `https://github.com/${GITHUB_OWNER}/${GITHUB_REPO}/blob/main/`;

            try {
                const response = await fetch(GITHUB_API_URL);
                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status}`);
                }
                const data = await response.json();
                
                if (!data.tree) {
                    throw new Error("Invalid API response format.");
                }

                // Process the flat file list into a structured project map
                const projectsMap = data.tree.reduce((acc, file) => {
                    const pathParts = file.path.split('/');
                    if (pathParts.length !== 2) return acc; // Only process files in top-level directories

                    const folderName = pathParts[0];
                    const fileName = pathParts[1];

                    if (!acc[folderName]) {
                        acc[folderName] = { folder: folderName };
                    }
                    if (fileName.endsWith('.html')) {
                        acc[folderName].htmlFile = fileName;
                    }
                    if (fileName.toLowerCase() === 'prompt.txt') {
                        acc[folderName].promptFile = fileName;
                    }

                    return acc;
                }, {});

                // Convert the map into the final projects array
                const projects = Object.values(projectsMap)
                    .filter(p => p.htmlFile) // Only include folders with an HTML file
                    .map(p => ({
                        name: p.folder.replace(/-/g, ' '),
                        liveUrl: `${LIVE_PAGE_BASE_URL}${p.folder}/${p.htmlFile}`,
                        promptUrl: p.promptFile 
                            ? `${GITHUB_BLOB_BASE_URL}${p.folder}/${p.promptFile}` 
                            : `${GITHUB_BLOB_BASE_URL}${p.folder}`,
                    }));

                // Save to cache with a version number and render
                const cachePayload = { version: CACHE_VERSION, projects: projects };
                sessionStorage.setItem(CACHE_KEY, JSON.stringify(cachePayload));
                renderProjects(projects);

            } catch (error) {
                console.error('Failed to load projects:', error);
                const gallery = document.getElementById('project-gallery');
                gallery.innerHTML = `<p class="col-span-full text-center text-red-500 font-medium">
                    Failed to load projects. This may be due to GitHub's API rate limiting. Please try again in a little while.
                </p>`;
            } finally {
                 loadingIndicator.style.display = 'none';
            }
        }
        
        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', loadProjects);

        document.getElementById('refresh-button').addEventListener('click', () => {
            sessionStorage.removeItem(CACHE_KEY);
            console.log("Cache cleared. Reloading page.");
            location.reload();
        });
    </script>

</body>
</html>

